<div class="list-card">
  <h2>All Users</h2>
  <p-confirmpopup key="deletePopup"> </p-confirmpopup>
  <p-table [value]="filteredUsers" [paginator]="true" [rows]="10" [loading]="loading()" scrollable="true">
    <ng-template #caption>
        <div class="flex">
            <p-iconfield iconPosition="left" class="ml-auto">
                <p-inputicon>
                    <i class="pi pi-search"></i>
                </p-inputicon>
                <input pInputText id="searchBox" [(ngModel)]="searchTerm" (ngModelChange)="filterUsers()" placeholder="Search 'use space for multiple'" autocomplete="off" />
            </p-iconfield>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th>Profile</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr *ngIf="user">
        <td>
            <img
                [src]="user?.profilePic"
                alt="profile pic"
                class="w-7rem border-round"
            />
        </td>
        <td>{{ user?.name }}</td>
        <td>{{ user?.email }}</td>

        <!-- Role with p-select -->
        <td>
          <p-select 
            [options]="roles"
            [(ngModel)]="user.role" 
            (onFocus)="onRoleFocus(user.role)"
            optionLabel="label"
            optionValue="value"
            placeholder="Select Role"
            styleClass="role-select"
            [disabled]="loggedUser?.email == user.email"
            (onChange)="onRoleChange(user , $event)">
          </p-select>
        </td>

        <!-- Status with p-checkbox -->
        <td>
          <div class="space flex-1 flex align-items-center justify-content-center sm:justify-content-between">
            <p-checkbox 
              [(ngModel)]="user.status" 
              binary="true"
              (onChange)="onStatusChange(user, $event)"
              [disabled]="loggedUser?.email == user.email">
            </p-checkbox>
            <p-badge [value]="user.status ? 'Active' : 'Inactive'" class=" sm:ml-4 md:ml-3 lg:ml-2 " [severity]="user.status ? 'success' : 'danger'" />
          </div>
        </td>

        <!-- Actions -->
        <td>
            <div class="action-icons">
                <i class="pi pi-pencil edit-icon" [title]="loggedUser?.email !=user.email ? 'edit' : 'cant edit'" (click)="loggedUser?.email !=user.email ? navigate(user._id) : null"></i>
                <i class="pi pi-trash delete-icon" [title]="loggedUser?.email !=user.email ? 'delete' : 'cant delete'" (click)="loggedUser?.email != user.email ? deleteUser(user?._id, $event) : null"></i>
            </div>
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
        <tr>
            <td colspan="5">No Users found</td>
        </tr>
    </ng-template>
  </p-table>

</div>
